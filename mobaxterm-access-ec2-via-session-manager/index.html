<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Mobaxterm 通过 Session Manager 访问 AWS EC2 实例 - Palfans's BLOG</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Palfans"><meta name=description content="需求 在 AWS 上部署了一个项目，包含四个 EC2 实例。其中一个为堡垒机实例，另外三个为业务实例。在子网的安全组中，关闭了 22 端口，只能通过 AWS 网页上的 Session Manager 访问堡垒机，再跳到其它业务机上。但 AWS 网页版的终端使用起来有很多限制，比如不能“选择即复制”，不能“右键快速粘贴”，会话无法保活等。 因此，希望可以使用桌面终端，比如 Mobaxterm，通过 Session Manager 来访问 EC2 实例。
解决方案 通过 AWS Command Line Interface(AWS CLI) 连接 Session Manager，经由 System Manager Agent(SSM Agent) 将所有操作转发给 EC2。
使用 Session Manager 的前提 EC2 实例安装了 SSM Agent EC2 实例绑定了 IAM Role AmazonSSMManagedInstanceCore EC2 可以直接或者通过 Session Manager 的 VPC Endpoint 连接 Session Mananger 服务 具体参照 AWS 官方文档进行设置。 "><meta name=keywords content="Palfans,blog"><meta name=google-site-verification content="7MLs3wY58s_Jjnto4NZgvoEHnnJc07ojBCBlgI1gTco"><meta name=generator content="Hugo 0.133.0 with theme even"><link rel=canonical href=https://www.palfans.net/mobaxterm-access-ec2-via-session-manager/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:url" content="https://www.palfans.net/mobaxterm-access-ec2-via-session-manager/"><meta property="og:site_name" content="Palfans's BLOG"><meta property="og:title" content="Mobaxterm 通过 Session Manager 访问 AWS EC2 实例"><meta property="og:description" content="需求 在 AWS 上部署了一个项目，包含四个 EC2 实例。其中一个为堡垒机实例，另外三个为业务实例。在子网的安全组中，关闭了 22 端口，只能通过 AWS 网页上的 Session Manager 访问堡垒机，再跳到其它业务机上。但 AWS 网页版的终端使用起来有很多限制，比如不能“选择即复制”，不能“右键快速粘贴”，会话无法保活等。 因此，希望可以使用桌面终端，比如 Mobaxterm，通过 Session Manager 来访问 EC2 实例。
解决方案 通过 AWS Command Line Interface(AWS CLI) 连接 Session Manager，经由 System Manager Agent(SSM Agent) 将所有操作转发给 EC2。
使用 Session Manager 的前提 EC2 实例安装了 SSM Agent EC2 实例绑定了 IAM Role AmazonSSMManagedInstanceCore EC2 可以直接或者通过 Session Manager 的 VPC Endpoint 连接 Session Mananger 服务 具体参照 AWS 官方文档进行设置。 "><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-01-25T03:04:41+00:00"><meta property="article:modified_time" content="2024-01-25T03:04:41+00:00"><meta property="article:tag" content="Ssh"><meta property="article:tag" content="Aws"><meta property="article:tag" content="Ec2"><meta property="article:tag" content="Mobaxterm"><meta itemprop=name content="Mobaxterm 通过 Session Manager 访问 AWS EC2 实例"><meta itemprop=description content="需求 在 AWS 上部署了一个项目，包含四个 EC2 实例。其中一个为堡垒机实例，另外三个为业务实例。在子网的安全组中，关闭了 22 端口，只能通过 AWS 网页上的 Session Manager 访问堡垒机，再跳到其它业务机上。但 AWS 网页版的终端使用起来有很多限制，比如不能“选择即复制”，不能“右键快速粘贴”，会话无法保活等。 因此，希望可以使用桌面终端，比如 Mobaxterm，通过 Session Manager 来访问 EC2 实例。
解决方案 通过 AWS Command Line Interface(AWS CLI) 连接 Session Manager，经由 System Manager Agent(SSM Agent) 将所有操作转发给 EC2。
使用 Session Manager 的前提 EC2 实例安装了 SSM Agent EC2 实例绑定了 IAM Role AmazonSSMManagedInstanceCore EC2 可以直接或者通过 Session Manager 的 VPC Endpoint 连接 Session Mananger 服务 具体参照 AWS 官方文档进行设置。 "><meta itemprop=datePublished content="2024-01-25T03:04:41+00:00"><meta itemprop=dateModified content="2024-01-25T03:04:41+00:00"><meta itemprop=wordCount content="872"><meta itemprop=keywords content="Ssh,Aws,Ec2,Mobaxterm"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mobaxterm 通过 Session Manager 访问 AWS EC2 实例"><meta name=twitter:description content="需求 在 AWS 上部署了一个项目，包含四个 EC2 实例。其中一个为堡垒机实例，另外三个为业务实例。在子网的安全组中，关闭了 22 端口，只能通过 AWS 网页上的 Session Manager 访问堡垒机，再跳到其它业务机上。但 AWS 网页版的终端使用起来有很多限制，比如不能“选择即复制”，不能“右键快速粘贴”，会话无法保活等。 因此，希望可以使用桌面终端，比如 Mobaxterm，通过 Session Manager 来访问 EC2 实例。
解决方案 通过 AWS Command Line Interface(AWS CLI) 连接 Session Manager，经由 System Manager Agent(SSM Agent) 将所有操作转发给 EC2。
使用 Session Manager 的前提 EC2 实例安装了 SSM Agent EC2 实例绑定了 IAM Role AmazonSSMManagedInstanceCore EC2 可以直接或者通过 Session Manager 的 VPC Endpoint 连接 Session Mananger 服务 具体参照 AWS 官方文档进行设置。 "><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Palfans's BLOG</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Palfans's BLOG</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Mobaxterm 通过 Session Manager 访问 AWS EC2 实例</h1><div class=post-meta><span class=post-time>2024-01-25</span><div class=post-category><a href=/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/>技术栈</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#需求>需求</a></li><li><a href=#解决方案>解决方案</a><ul><li><a href=#使用-session-manager-的前提>使用 Session Manager 的前提</a></li><li><a href=#安装配置-aws-cli>安装配置 AWS CLI</a></li><li><a href=#配置-mobaxterm>配置 Mobaxterm</a></li></ul></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=需求>需求</h2><p>在 AWS 上部署了一个项目，包含四个 EC2 实例。其中一个为堡垒机实例，另外三个为业务实例。在子网的安全组中，关闭了 22 端口，只能通过 AWS 网页上的 Session Manager 访问堡垒机，再跳到其它业务机上。但 AWS 网页版的终端使用起来有很多限制，比如不能“选择即复制”，不能“右键快速粘贴”，会话无法保活等。
因此，希望可以使用桌面终端，比如 Mobaxterm，通过 Session Manager 来访问 EC2 实例。</p><h2 id=解决方案>解决方案</h2><p>通过 <code>AWS Command Line Interface(AWS CLI)</code> 连接 Session Manager，经由 <code>System Manager Agent(SSM Agent)</code> 将所有操作转发给 EC2。</p><h3 id=使用-session-manager-的前提>使用 Session Manager 的前提</h3><ul><li>EC2 实例安装了 <code>SSM Agent</code></li><li>EC2 实例绑定了 IAM Role <code>AmazonSSMManagedInstanceCore</code></li><li>EC2 可以直接或者通过 Session Manager 的 VPC Endpoint 连接 Session Mananger 服务
具体参照 AWS <a href=https://docs.aws.amazon.com/zh_cn/systems-manager/latest/userguide/systems-manager-setting-up.html>官方文档</a>进行设置。</li></ul><h3 id=安装配置-aws-cli>安装配置 AWS CLI</h3><p>首先参照 AWS <a href=https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/getting-started-install.html>官方文档</a> 安装或者更新 AWS CLI 的最新版本。</p><p>要通过 AWS CLI 启动 Session Manager 会话，还必须安装 Session Manager 插件，参照 AWS <a href=https://docs.aws.amazon.com/zh_cn/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html>官方文档</a></p><p>在 <a href="https://us-east-1.console.aws.amazon.com/iam/home#/security_credentials?section=IAM_credentials">IAM</a> 中创建 Access Key，记下 Key ID 和 Secret。</p><p>在本地终端中执行 <code>aws configure</code>，填入刚刚创建的 Access Key，Secret，和 EC2 实例所在的区域，比如<code>us-east-1</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>palfans@lab:~/.aws$ aws configure
</span></span><span class=line><span class=cl>AWS Access Key ID []:
</span></span><span class=line><span class=cl>AWS Secret Access Key []:
</span></span><span class=line><span class=cl>Default region name []:
</span></span><span class=line><span class=cl>Default output format [None]:
</span></span></code></pre></td></tr></table></div></div><p>在本地终端中执行<code>aws ec2 describe-instances | grep InstanceId</code>，获取到 EC2 实例ID，然后用<code>aws ssm start-session --target &lt;InstanceId></code>连接到 EC2。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>palfans@lab:~/.aws$ aws ec2 describe-instances | grep InstanceId
</span></span><span class=line><span class=cl>                    &#34;InstanceId&#34;: &#34;i-09721fab06a6d0000&#34;,
</span></span><span class=line><span class=cl>palfans@lab:~/.aws$
</span></span><span class=line><span class=cl>palfans@lab:~/.aws$ aws ssm start-session --target i-09721fab06a6d0000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Starting session with SessionId: palfans-094975208f6800000
</span></span><span class=line><span class=cl>sh-5.2$
</span></span></code></pre></td></tr></table></div></div><h3 id=配置-mobaxterm>配置 Mobaxterm</h3><p>现在已经可以通过 AWS CLI 访问 EC2，还需要支持 SSH，以便拥有更多功能的 Mobaxterm 等终端软件可以连接。</p><p>首先在堡垒机的<code>~/.ssh/authorized_keys</code>中添加公钥，之后就可以用私钥进行校验。</p><p>然后在 Mobaxterm 中新建一个 SSH 连接，Remote host 为 EC2 的 <code>InstanceId</code>，比如 i-09721fab06a6d0000。用户名为 <code>ec2-user</code>。</p><p>在<code>Advanced SSH settings</code>-><code>Use private key</code>中，选择对应的私钥文件。</p><p>在<code>Network settings</code>-><code>Proxy settings</code>中，Proxy type为<code>Local</code>，Local proxy command为<code>aws ssm start-session --target %host --document-name AWS-StartSSHSession --parameters 'portNumber=%port'</code>。</p><p>如果 AWS CLI 是安装在 Windows 附带的 WSL2 中，则 Local proxy command为<code>wsl aws ssm start-session --target %host --document-name AWS-StartSSHSession --parameters 'portNumber=%port'</code>。</p><p>保存后即可在 Mobaxterm 中连接 EC2。</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Palfans</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2024-01-25</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/ssh/>ssh</a>
<a href=/tags/aws/>aws</a>
<a href=/tags/ec2/>ec2</a>
<a href=/tags/mobaxterm/>mobaxterm</a></div><nav class=post-nav><a class=prev href=/git-cherry-pick-and-rebase/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">使用 Git 进行 Cherry Pick 和 Rebase</span>
<span class="prev-text nav-mobile">上一篇</span>
</a><a class=next href=/iptv-php-scraping-snippet/><span class="next-text nav-default">IPTV PHP 爬虫片段</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=palfans/blog-comments issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:admin@palfans.net class="iconfont icon-email" title=email></a><a href=https://twitter.com/palfans class="iconfont icon-twitter" title=twitter></a><a href=https://www.palfans.net/mobaxterm-access-ec2-via-session-manager/ type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span><span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span><span class=copyright-year>&copy;
2005 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span></span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html>